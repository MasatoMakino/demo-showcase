<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PACKAGE_NAME}}</title>
    <!-- Icon from Font Awesome (CC BY 4.0 License): https://fontawesome.com/license/free -->
    <!-- Converted from: https://fontawesome.com/icons/file-lines?s=solid -->
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link
            rel="stylesheet"
            href="https://unpkg.com/purecss@3.0.0/build/pure-min.css"
            integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls"
            crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" type="text/css"/>

    <script src="./indexScript.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", (e) => {

            var menuItems = document.getElementsByClassName('pure-menu-item');
            var demoPathsElement = document.querySelector('.pure-menu-list');
            var demoPaths = JSON.parse(demoPathsElement.dataset.demoPaths);

            function init() {
                for( var i = 0 ; i < menuItems.length; i++ ){
                    var item = menuItems[i];
                    item.addEventListener("click", (e)=> {
                        selectMenu(e.currentTarget);
                    })
                }
                var initialDemoPath = getInitialDemoPath(demoPaths);
                setIframeSrc(initialDemoPath);
                selectInitialMenuItem(initialDemoPath);
            }

            function selectMenu( item ){
                removeAllClass(menuItems);
                item.classList.add('pure-menu-selected');

                var demoPath = item.querySelector('.pure-menu-link').getAttribute('href');
                var demoName = getDemoNameFromPath(demoPath);
                if (demoName) {
                    history.pushState({}, '', '?demo=' + demoName);
                } else {
                    history.pushState({}, '', window.location.pathname);
                }
            }

            function removeAllClass(items){
                for( var i = 0 ; i < items.length; i++ ){
                    var item = menuItems[i];
                    item.classList.remove('pure-menu-selected');
                }
            }

            function getInitialDemoPath(paths) {
                var params = new URLSearchParams(window.location.search);
                var demoName = params.get('demo');

                if (demoName) {
                    for (var i = 0; i < paths.length; i++) {
                        if (getDemoNameFromPath(paths[i]) === demoName) {
                            return paths[i];
                        }
                    }
                }
                return paths[0];
            }

            function setIframeSrc(path) {
                var iframe = document.getElementById('demo-frame');
                if (iframe) {
                    iframe.src = path;
                }
            }

            function selectInitialMenuItem(initialPath) {
                 for( var i = 0 ; i < menuItems.length; i++ ){
                    var item = menuItems[i];
                    var demoPath = item.querySelector('.pure-menu-link').getAttribute('href');
                    if (demoPath === initialPath) {
                        selectMenu(item);
                        break;
                    }
                }
            }

            init();

            function initToggleMenu(){
                var layout   = document.getElementById('layout'),
                    menu     = document.getElementById('menu'),
                    menuLink = document.getElementById('menuLink');

                function toggleClass(element, className) {
                    var classes = element.className.split(/\s+/),
                        length = classes.length,
                        i = 0;

                    for (; i < length; i++) {
                        if (classes[i] === className) {
                            classes.splice(i, 1);
                            break;
                        }
                    }
                    if (length === classes.length) {
                        classes.push(className);
                    }

                    element.className = classes.join(' ');
                }

                function toggleAll(e) {
                    var active = 'active';
                    toggleClass(layout, active);
                    toggleClass(menu, active);
                    toggleClass(menuLink, active);
                }

                function handleEvent(e) {
                    if (e.target.id === menuLink.id) {
                        return toggleAll(e);
                    }
                    if (menu.className.indexOf('active') !== -1) {
                        return toggleAll(e);
                    }
                }

                document.addEventListener('click', handleEvent);
            }
            initToggleMenu();

        });
    </script>

</head>
<body>
<div id="layout">
    <a href="#menu" id="menuLink" class="menu-link">
        <span></span>
    </a>
    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="{{REPOSITORY}}">{{PACKAGE_NAME}}</a>
            <ul class="pure-menu-list" data-demo-paths="{{DEMO_PATHS}}">
                {{DEMO_MENU_ITEMS}}
            </ul>
        </div>
    </div>
    <iframe name="demo-frame" id="demo-frame" src=""></iframe>
</div>
</body>
</html>
